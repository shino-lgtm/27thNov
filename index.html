<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ - My Firestore App</title>
Â  Â  <style>
Â  Â  Â  Â  /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background-color: #f4f7f6;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 900px;
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #00A3A0; /* ãƒ†ã‚£ãƒ•ã‚¡ãƒ‹ãƒ¼ãƒ–ãƒ«ãƒ¼ç³» */
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* èªè¨¼UIã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #auth-ui {
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  Â  }
Â  Â  Â  Â  #login-button, #logout-button, #mypage-button, #all-events-button {
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  margin-left: 10px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #login-button {
Â  Â  Â  Â  Â  Â  background-color: #0ABAB5;Â 
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #login-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #00A3A0;
Â  Â  Â  Â  }
Â  Â  Â  Â  #logout-button {
Â  Â  Â  Â  Â  Â  background-color: #fbbc05;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  #logout-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #e0ac03;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* ãƒã‚¤ãƒšãƒ¼ã‚¸/å…¨ã‚¤ãƒ™ãƒ³ãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #mypage-button, #all-events-button {
Â  Â  Â  Â  Â  Â  background-color: #00A3A0;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  #mypage-button:hover, #all-events-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #008f8c;
Â  Â  Â  Â  }
Â  Â  Â  Â  .view-active {
Â  Â  Â  Â  Â  Â  Â background-color: #0ABAB5 !important;
Â  Â  Â  Â  Â  Â  Â box-shadow: 0 0 0 2px #E0FFFF;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« (çœç•¥) */
Â  Â  Â  Â  #search-controls { display: flex; gap: 10px; margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; }
Â  Â  Â  Â  #search-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
Â  Â  Â  Â  #search-button, #clear-button { padding: 10px 15px; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; transition: background-color 0.2s ease; }
Â  Â  Â  Â  #search-button { background-color: #00A3A0; }
Â  Â  Â  Â  #search-button:hover { background-color: #008f8c; }
Â  Â  Â  Â  #clear-button { background-color: #fbbc05; white-space: nowrap; }
Â  Â  Â  Â  #clear-button:hover { background-color: #e0ac03; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* ã‚¿ã‚°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« (çœç•¥) */
Â  Â  Â  Â  #tag-list { padding: 10px 0 25px 0; margin-bottom: 20px; border-bottom: 1px solid #eee; }
Â  Â  Â  Â  .tag-button { background-color: #e0e0e0; color: #333; border: 1px solid #ccc; padding: 6px 12px; margin-right: 8px; margin-bottom: 8px; border-radius: 18px; font-size: 0.9em; cursor: pointer; transition: background-color 0.2s, color 0.2s, border-color 0.2s; display: inline-block; }
Â  Â  Â  Â  .tag-button:hover { background-color: #d0d0d0; }
Â  Â  Â  Â  .tag-button.active { background-color: #0ABAB5; color: white; border-color: #0ABAB5; font-weight: bold; }

Â  Â  Â  Â  /* ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #events-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
Â  Â  Â  Â  .event-card {
Â  Â  Â  Â  Â  Â  background-color: #E0FFFF;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  Â  Â  transition: transform 0.2s ease-in-out;
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .event-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
Â  Â  Â  Â  .event-card .event-image { max-width: 100%; height: auto; border-radius: 5px; margin-bottom: 15px; display: block; }
Â  Â  Â  Â  .event-card h2 { color: #0ABAB5; margin-top: 0; font-size: 1.5em; margin-bottom: 10px; }
Â  Â  Â  Â  .event-card p { margin-bottom: 8px; font-size: 0.95em; }
Â  Â  Â  Â  .event-card .date { font-weight: bold; color: #34a853; }Â 
Â  Â  Â  Â  .event-card .location { color: #ea4335; }Â 
Â  Â  Â  Â  .event-tags { margin-top: 10px; font-size: 0.85em; color: #757575; }
Â  Â  Â  Â  .event-tag { display: inline-block; background-color: #cccccc; color: #333; padding: 3px 8px; margin-right: 5px; margin-bottom: 5px; border-radius: 4px; }

Â  Â  Â  Â  /* ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  .favorite-button {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 10px;
Â  Â  Â  Â  Â  Â  right: 10px;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  transition: transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .favorite-button:hover { transform: scale(1.1); }
Â  Â  Â  Â  .favorite-button.empty { color: #a0a0a0; }
Â  Â  Â  Â  .favorite-button.filled { color: #ff4d4d; }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  .loading-message, .error-message { text-align: center; font-size: 1.1em; margin-top: 20px; padding: 15px; border-radius: 5px; }
Â  Â  Â  Â  .loading-message { background-color: #fff3cd; color: #856404; }
Â  Â  Â  Â  .error-message { background-color: #f8d7da; color: #721c24; }
Â  Â  Â  Â  #loadEventsButton { display: none; }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <div id="auth-ui">
Â  Â  Â  Â  Â  Â  <button id="all-events-button" class="view-active">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</button>
Â  Â  Â  Â  Â  Â  <button id="mypage-button">ãŠæ°—ã«å…¥ã‚Š</button>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <span id="user-status">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚</span>
Â  Â  Â  Â  Â  Â  <button id="login-button">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
Â  Â  Â  Â  Â  Â  <button id="logout-button" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <h1 id="main-title">ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ</h1> <div id="search-controls">
Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦çµã‚Šè¾¼ã¿ (ä¾‹: æ±äº¬, AI)">
Â  Â  Â  Â  Â  Â  <button id="search-button">æ¤œç´¢</button>
Â  Â  Â  Â  Â  Â  <button id="clear-button" title="æ¤œç´¢æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢ã—ã¦å…¨ä»¶è¡¨ç¤º">ã‚¯ãƒªã‚¢</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="tag-list">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="events-list">
Â  Â  Â  Â  Â  Â  <p class="loading-message" id="initial-message">ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  // Firebase SDKã®å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™
Â  Â  Â  Â  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
Â  Â  Â  Â  import {Â 
Â  Â  Â  Â  Â  Â  getFirestore,Â 
Â  Â  Â  Â  Â  Â  collection,Â 
Â  Â  Â  Â  Â  Â  getDocs,Â 
Â  Â  Â  Â  Â  Â  orderBy,Â 
Â  Â  Â  Â  Â  Â  query,Â 
Â  Â  Â  Â  Â  Â  where,Â 
Â  Â  Â  Â  Â  Â  doc,Â 
Â  Â  Â  Â  Â  Â  setDoc,Â 
Â  Â  Â  Â  Â  Â  deleteDoc,
Â  Â  Â  Â  Â  Â  serverTimestampÂ 
Â  Â  Â  Â  } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
Â  Â  Â  Â  import {Â 
Â  Â  Â  Â  Â  Â  getAuth,Â 
Â  Â  Â  Â  Â  Â  signInWithPopup,Â 
Â  Â  Â  Â  Â  Â  GoogleAuthProvider,Â 
Â  Â  Â  Â  Â  Â  onAuthStateChanged,
Â  Â  Â  Â  Â  Â  signOutÂ 
Â  Â  Â  Â  } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';


Â  Â  Â  Â  // --- ã‚ãªãŸã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š ---
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyBH8EPKOwIBIMR16Z7PTECc2Lp0Y5cfkHQ",
Â  Â  Â  Â  Â  Â  authDomain: "november5th-a1336.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "november5th-a1336",
Â  Â  Â  Â  Â  Â  storageBucket: "november5th-a1336.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "11537951889",
Â  Â  Â  Â  Â  Â  appId: "1:11537951889:web:d783b2298fc90f88a3a330"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  const auth = getAuth(app);Â 

Â  Â  Â  Â  // DOMè¦ç´ ã¸ã®å‚ç…§ã‚’å–å¾—
Â  Â  Â  Â  const eventsListContainer = document.getElementById('events-list');
Â  Â  Â  Â  const searchInput = document.getElementById('search-input');
Â  Â  Â  Â  const searchButton = document.getElementById('search-button');
Â  Â  Â  Â  const clearButton = document.getElementById('clear-button');
Â  Â  Â  Â  const tagListContainer = document.getElementById('tag-list');
Â  Â  Â  Â  const mainTitle = document.getElementById('main-title');Â 

Â  Â  Â  Â  const loginButton = document.getElementById('login-button');
Â  Â  Â  Â  const logoutButton = document.getElementById('logout-button');
Â  Â  Â  Â  const userStatus = document.getElementById('user-status');
Â  Â  Â  Â  const mypageButton = document.getElementById('mypage-button');
Â  Â  Â  Â  const allEventsButton = document.getElementById('all-events-button');


Â  Â  Â  Â  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ç®¡ç†å¤‰æ•°
Â  Â  Â  Â  let allEventsCache = [];Â 
Â  Â  Â  Â  let currentActiveTag = '';Â 
Â  Â  Â  Â  let favoriteEventIds = new Set();Â 
Â  Â  Â  Â  let currentView = 'all';Â 

Â  Â  Â  Â  // --- èªè¨¼æ©Ÿèƒ½ã®é–¢æ•° ---
Â  Â  Â  Â  async function loginWithGoogle() {
Â  Â  Â  Â  Â  Â  const provider = new GoogleAuthProvider();
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await signInWithPopup(auth, provider);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Googleãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", error.message);
Â  Â  Â  Â  Â  Â  Â  Â  alert("ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function signOutUser() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  Â  Â  favoriteEventIds = new Set();
Â  Â  Â  Â  Â  Â  Â  Â  currentView = 'all';
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error.message);
Â  Â  Â  Â  Â  Â  Â  Â  alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function fetchFavoriteIds() {
Â  Â  Â  Â  Â  Â  const userId = auth.currentUser ? auth.currentUser.uid : null;
Â  Â  Â  Â  Â  Â  if (!userId) {
Â  Â  Â  Â  Â  Â  Â  Â  favoriteEventIds = new Set();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const favoritesColRef = collection(db, "favorites");
Â  Â  Â  Â  Â  Â  Â  Â  const q = query(favoritesColRef, where("userId", "==", userId));
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  favoriteEventIds = new Set(snapshot.docs.map(doc => doc.data().eventId));
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â console.error("ãŠæ°—ã«å…¥ã‚ŠIDã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â favoriteEventIds = new Set();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function toggleFavorite(eventId) {
Â  Â  Â  Â  Â  Â  const user = auth.currentUser;
Â  Â  Â  Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const userId = user.uid;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const docId = `${userId}_${eventId}`;
Â  Â  Â  Â  Â  Â  const docRef = doc(db, "favorites", docId);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const isCurrentlyFavorite = favoriteEventIds.has(eventId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (isCurrentlyFavorite) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(docRef);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  favoriteEventIds.delete(eventId);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(docRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: userId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventId: eventId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  favoriteEventIds.add(eventId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadEvents(searchInput.value, currentActiveTag);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("ãŠæ°—ã«å…¥ã‚Šæ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸã€‚Firestoreã®ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Firestoreãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»è¡¨ç¤ºé–¢æ•° ---
Â  Â  Â  Â  async function fetchAllEvents() {
Â  Â  Â  Â  Â  Â  if (allEventsCache.length > 0) { return allEventsCache; }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const eventsCollectionRef = collection(db, "events");
Â  Â  Â  Â  Â  Â  Â  Â  const q = query(eventsCollectionRef, orderBy("date", "asc"));
Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let eventsData = [];
Â  Â  Â  Â  Â  Â  Â  Â  let uniqueTags = new Set();Â 

Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventData = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.id = doc.id;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventsData.push(eventData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagsArray = Array.isArray(eventData.tags) ? eventData.tags : (typeof eventData.tags === 'string' ? eventData.tags.split(',') : []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagsArray.forEach(tag => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const t = tag.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (t) uniqueTags.add(t);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  allEventsCache = eventsData;
Â  Â  Â  Â  Â  Â  Â  Â  createTagButtons(Array.from(uniqueTags));Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  return eventsData;
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
Â  Â  Â  Â  Â  Â  Â  Â  eventsListContainer.innerHTML = `<p class="error-message">ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function createTagButtons(tags) {
Â  Â  Â  Â  Â  Â  tagListContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const allButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  allButton.textContent = "å…¨ã¦";
Â  Â  Â  Â  Â  Â  allButton.className = 'tag-button';
Â  Â  Â  Â  Â  Â  allButton.addEventListener('click', () => handleTagClick(""));
Â  Â  Â  Â  Â  Â  tagListContainer.appendChild(allButton);

Â  Â  Â  Â  Â  Â  tags.sort().forEach(tag => {
Â  Â  Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = tag;
Â  Â  Â  Â  Â  Â  Â  Â  button.className = 'tag-button';
Â  Â  Â  Â  Â  Â  Â  Â  button.setAttribute('data-tag', tag);
Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => handleTagClick(tag));
Â  Â  Â  Â  Â  Â  Â  Â  tagListContainer.appendChild(button);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  updateTagButtonsUI(currentActiveTag);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleTagClick(tag) {
Â  Â  Â  Â  Â  Â  searchInput.value = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const newTag = (currentActiveTag === tag) ? "" : tag;
Â  Â  Â  Â  Â  Â  currentActiveTag = newTag;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateTagButtonsUI(newTag);
Â  Â  Â  Â  Â  Â  loadEvents(searchInput.value, newTag);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTagButtonsUI(activeTag) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tag-button').forEach(button => {
Â  Â  Â  Â  Â  Â  Â  Â  button.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  if (button.getAttribute('data-tag') === activeTag || (!activeTag && button.textContent === "å…¨ã¦")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateViewButtonsUI() {
Â  Â  Â  Â  Â  Â  allEventsButton.classList.remove('view-active');
Â  Â  Â  Â  Â  Â  mypageButton.classList.remove('view-active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentView === 'all') {
Â  Â  Â  Â  Â  Â  Â  Â  allEventsButton.classList.add('view-active');
Â  Â  Â  Â  Â  Â  Â  Â  mainTitle.textContent = "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ";Â 
Â  Â  Â  Â  Â  Â  Â  Â  tagListContainer.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  searchButton.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â  clearButton.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  mypageButton.classList.add('view-active');
Â  Â  Â  Â  Â  Â  Â  Â  mainTitle.textContent = "ãŠæ°—ã«å…¥ã‚Š";Â 
Â  Â  Â  Â  Â  Â  Â  Â  tagListContainer.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  searchButton.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  clearButton.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const isUserLoggedIn = auth.currentUser !== null;
Â  Â  Â  Â  Â  Â  mypageButton.style.display = isUserLoggedIn ? 'inline-block' : 'none';
Â  Â  Â  Â  Â  Â  allEventsButton.style.display = isUserLoggedIn ? 'inline-block' : 'none';
Â  Â  Â  Â  }


Â  Â  Â  Â  async function loadEvents(keyword = searchInput.value, selectedTag = currentActiveTag) {
Â  Â  Â  Â  Â  Â  const lowerCaseKeyword = keyword.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const trimSelectedTag = selectedTag.trim();

Â  Â  Â  Â  Â  Â  updateViewButtonsUI();
Â  Â  Â  Â  Â  Â  eventsListContainer.innerHTML = '<p class="loading-message">ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...</p>';
Â  Â  Â  Â  Â  Â  searchButton.disabled = true;
Â  Â  Â  Â  Â  Â  clearButton.disabled = true;
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tag-button').forEach(b => b.disabled = true);

Â  Â  Â  Â  Â  Â  const eventsData = await fetchAllEvents();
Â  Â  Â  Â  Â  Â  if (eventsData.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â searchButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â clearButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â document.querySelectorAll('.tag-button').forEach(b => b.disabled = false);
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 1. è¤‡åˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  now.setHours(0, 0, 0, 0);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let filteredEvents = eventsData.filter(event => {
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
Â  Â  Â  Â  Â  Â  Â  Â  if (currentView === 'favorites' && !favoriteEventIds.has(event.id)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // éå»ã®æ—¥ä»˜ã‚’éè¡¨ç¤º
Â  Â  Â  Â  Â  Â  Â  Â  const eventDateObj = event.date ? (event.date.toDate ? event.date.toDate() : new Date(event.date)) : null;
Â  Â  Â  Â  Â  Â  Â  Â  if (!eventDateObj || eventDateObj < now) { return false; }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆå…¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ“ãƒ¥ãƒ¼ã§ã®ã¿é©ç”¨ï¼‰
Â  Â  Â  Â  Â  Â  Â  Â  if (currentView === 'all' && trimSelectedTag) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventTags = Array.isArray(event.tags) ? event.tags : (typeof event.tags === 'string' ? event.tags.split(',').map(t => t.trim()) : []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!eventTags.includes(trimSelectedTag)) { return false; }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
Â  Â  Â  Â  Â  Â  Â  Â  if (lowerCaseKeyword) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = (event.title || '').toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const description = (event.description || '').toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const location = (event.location || '').toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tags = Array.isArray(event.tags) ? event.tags.join(' ').toLowerCase() : (event.tags || '').toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!(title.includes(lowerCaseKeyword) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â description.includes(lowerCaseKeyword) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â location.includes(lowerCaseKeyword) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tags.includes(lowerCaseKeyword))) { return false; }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // 2. HTMLæç”»
Â  Â  Â  Â  Â  Â  eventsListContainer.innerHTML = '';Â 

Â  Â  Â  Â  Â  Â  if (filteredEvents.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  let message = currentView === 'favorites'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `ãŠæ°—ã«å…¥ã‚Šã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`;
Â  Â  Â  Â  Â  Â  Â  Â  eventsListContainer.innerHTML = `<p class="loading-message">${message}</p>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  filteredEvents.forEach((eventData) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventCard = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventCard.className = 'event-card';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = eventData.title || 'ã‚¿ã‚¤ãƒˆãƒ«ãªã—';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = eventData.date ? (eventData.date.toDate ? eventData.date.toDate().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }) : eventData.date) : 'æ—¥ä»˜æœªå®š';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const description = eventData.description || 'èª¬æ˜ãªã—';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const location = eventData.location || 'å ´æ‰€æœªå®š';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageUrl = eventData.imageUrl || '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventId = eventData.id;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isFavorite = favoriteEventIds.has(eventId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const heartIconClass = isFavorite ? 'filled' : 'empty';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const heartIcon = isFavorite ? 'â¤ï¸' : 'ğŸ¤';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let tagsHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagsArray = Array.isArray(eventData.tags) ? eventData.tags : (typeof eventData.tags === 'string' ? eventData.tags.split(',').map(t => t.trim()) : []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (tagsArray.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagSpans = tagsArray.map(tag =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<span class="event-tag">${tag.trim()}</span>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagsHtml = `<div class="event-tags">${tagSpans}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventCard.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${auth.currentUser ? `<span class="favorite-button ${heartIconClass}" data-event-id="${eventId}">${heartIcon}</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${imageUrl ? `<img src="${imageUrl}" alt="${title}" class="event-image">` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>${title}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="date">æ—¥ä»˜: ${date}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>å ´æ‰€:</strong> ${location}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>${description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tagsHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventsListContainer.appendChild(eventCard);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // â˜…â˜…â˜… ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç¢ºå®Ÿãªè¨­å®š â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (auth.currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const favButton = eventCard.querySelector('.favorite-button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (favButton) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  favButton.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleFavorite(eventId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  searchButton.disabled = false;
Â  Â  Â  Â  Â  Â  clearButton.disabled = false;
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tag-button').forEach(b => b.disabled = false);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
Â  Â  Â  Â  loginButton.addEventListener('click', loginWithGoogle);
Â  Â  Â  Â  logoutButton.addEventListener('click', signOutUser);

Â  Â  Â  Â  // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒªã‚¹ãƒŠãƒ¼
Â  Â  Â  Â  mypageButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentView = 'favorites';
Â  Â  Â  Â  Â  Â  currentActiveTag = '';
Â  Â  Â  Â  Â  Â  searchInput.value = '';
Â  Â  Â  Â  Â  Â  updateTagButtonsUI('');
Â  Â  Â  Â  Â  Â  loadEvents();
Â  Â  Â  Â  });

Â  Â  Â  Â  allEventsButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentView = 'all';
Â  Â  Â  Â  Â  Â  currentActiveTag = '';
Â  Â  Â  Â  Â  Â  searchInput.value = '';
Â  Â  Â  Â  Â  Â  updateTagButtonsUI('');
Â  Â  Â  Â  Â  Â  loadEvents();
Â  Â  Â  Â  });

Â  Â  Â  Â  searchButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentView = 'all';Â 
Â  Â  Â  Â  Â  Â  currentActiveTag = "";
Â  Â  Â  Â  Â  Â  updateTagButtonsUI("");
Â  Â  Â  Â  Â  Â  loadEvents(searchInput.value, "");
Â  Â  Â  Â  });

Â  Â  Â  Â  clearButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  searchInput.value = '';
Â  Â  Â  Â  Â  Â  currentActiveTag = "";
Â  Â  Â  Â  Â  Â  updateTagButtonsUI("");
Â  Â  Â  Â  Â  Â  loadEvents('', "");
Â  Â  Â  Â  });

Â  Â  Â  Â  searchInput.addEventListener('keypress', (e) => {
Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  searchButton.click();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  const isUserLoggedIn = user !== null;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  userStatus.textContent = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${user.displayName || user.email}`;
Â  Â  Â  Â  Â  Â  Â  Â  loginButton.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  logoutButton.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await fetchFavoriteIds();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  userStatus.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  loginButton.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â  logoutButton.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateViewButtonsUI();

Â  Â  Â  Â  Â  Â  if (allEventsCache.length === 0 || isUserLoggedIn) {
Â  Â  Â  Â  Â  Â  Â  Â  Â fetchAllEvents().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â loadEvents();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â loadEvents();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
